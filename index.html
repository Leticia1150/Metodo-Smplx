<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Resolución de Programación Lineal</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }
    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
    }
    input[type=text], select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
    }
    button {
      background-color: #007bff;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    #output, #grafico {
      margin-top: 30px;
    }
    #grafico {
      height: 500px;
    }
  </style>
</head>
<body>
  <h1>Resolución de Programación Lineal</h1>

  <label for="funcionObjetivo">Función Objetivo (ej: Z = 12x + 20y):</label>
  <input type="text" id="funcionObjetivo" placeholder="Z = 12x + 20y">

  <label for="restriccion1">Restricción 1 (ej: 2x + 3y <= 120):</label>
  <input type="text" id="restriccion1" placeholder="2x + 3y <= 120">

  <label for="restriccion2">Restricción 2 (ej: x + y <= 45):</label>
  <input type="text" id="restriccion2" placeholder="x + y <= 45">

  <button onclick="resolver()">Resolver</button>

  <div id="output"></div>
  <div id="grafico"></div>

  <script>
    function parseRestriccion(text) {
      const match = text.match(/([\d\.\-]+)?x\s*([\+\-]?\s*[\d\.\-]+)?y\s*([<>=]+)\s*([\d\.\-]+)/);
      if (!match) return null;
      return {
        a: parseFloat(match[1] || 1),
        b: parseFloat((match[2] || '1').replace(/\s+/g, '')),
        signo: match[3],
        rhs: parseFloat(match[4])
      };
    }

    function resolver() {
      const Z = document.getElementById("funcionObjetivo").value;
      const r1 = parseRestriccion(document.getElementById("restriccion1").value);
      const r2 = parseRestriccion(document.getElementById("restriccion2").value);
      if (!r1 || !r2) {
        alert("Revisa el formato de las restricciones.");
        return;
      }

      const coef = Z.match(/Z\s*=\s*([\d\.\-]+)?x\s*([\+\-]?\s*[\d\.\-]+)?y/);
      if (!coef) {
        alert("Formato inválido en la función objetivo. Usa: Z = 12x + 20y");
        return;
      }
      const c1 = parseFloat(coef[1] || 1);
      const c2 = parseFloat((coef[2] || '1').replace(/\s+/g, ''));

      const puntos = [
        {x: 0, y: r1.rhs / r1.b},
        {x: r1.rhs / r1.a, y: 0},
        {x: 0, y: r2.rhs / r2.b},
        {x: r2.rhs / r2.a, y: 0},
      ];

      const det = r1.a * r2.b - r2.a * r1.b;
      if (det !== 0) {
        const x = (r1.rhs * r2.b - r2.rhs * r1.b) / det;
        const y = (r1.a * r2.rhs - r2.a * r1.rhs) / det;
        if (x >= 0 && y >= 0) puntos.push({x, y});
      }

      const factible = puntos.filter(p =>
        r1.a*p.x + r1.b*p.y <= r1.rhs &&
        r2.a*p.x + r2.b*p.y <= r2.rhs &&
        p.x >= 0 && p.y >= 0
      );

      if (factible.length === 0) {
        document.getElementById("output").innerHTML = "<p>No hay región factible.</p>";
        Plotly.newPlot('grafico', []);
        return;
      }

      let maxZ = -Infinity;
      let optimo = {x: 0, y: 0};
      factible.forEach(p => {
        const z = c1 * p.x + c2 * p.y;
        if (z > maxZ) {
          maxZ = z;
          optimo = p;
        }
      });

      document.getElementById("output").innerHTML =
        `<h3>Solución óptima:</h3>
         <p>x = ${optimo.x.toFixed(2)}</p>
         <p>y = ${optimo.y.toFixed(2)}</p>
         <p>Z = ${maxZ.toFixed(2)}</p>`;

      const trace = {
        x: factible.map(p => p.x).concat(factible[0].x),
        y: factible.map(p => p.y).concat(factible[0].y),
        type: 'scatter',
        mode: 'lines+markers',
        fill: 'toself',
        name: 'Región factible',
        fillcolor: 'rgba(0,100,255,0.3)',
        line: { color: 'blue' }
      };

      const punto = {
        x: [optimo.x],
        y: [optimo.y],
        type: 'scatter',
        mode: 'markers+text',
        text: [`Z=${maxZ.toFixed(2)}`],
        textposition: 'top right',
        name: 'Punto óptimo',
        marker: { color: 'red', size: 10 }
      };

      Plotly.newPlot('grafico', [trace, punto], {
        xaxis: { title: 'x', range: [0, Math.max(...factible.map(p => p.x)) + 5] },
        yaxis: { title: 'y', range: [0, Math.max(...factible.map(p => p.y)) + 5] },
        title: 'Zona factible y punto óptimo'
      });
    }
  </script>
</body>
</html>
